<!DOCTYPE html><html lang="en" dir="ltr"><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="generator" content="ReSpec 35.1.1">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<style>
.issue-label{text-transform:initial}
.warning>p:first-child{margin-top:0}
.warning{padding:.5em;border-left-width:.5em;border-left-style:solid}
span.warning{padding:.1em .5em .15em}
.issue.closed span.issue-number{text-decoration:line-through}
.issue.closed span.issue-number::after{content:" (Closed)";font-size:smaller}
.warning{border-color:#f11;border-color:var(--warning-border,#f11);border-width:.2em;border-style:solid;background:#fbe9e9;background:var(--warning-bg,#fbe9e9);color:#000;color:var(--text,#000)}
.warning-title:before{content:"⚠";font-size:1.3em;float:left;padding-right:.3em;margin-top:-.3em}
li.task-list-item{list-style:none}
input.task-list-item-checkbox{margin:0 .35em .25em -1.6em;vertical-align:middle}
.issue a.respec-gh-label{padding:5px;margin:0 2px 0 2px;font-size:10px;text-transform:none;text-decoration:none;font-weight:700;border-radius:4px;position:relative;bottom:2px;border:none;display:inline-block}
</style>
<style>
dfn{cursor:pointer}
.dfn-panel{position:absolute;z-index:35;min-width:300px;max-width:500px;padding:.5em .75em;margin-top:.6em;font-family:"Helvetica Neue",sans-serif;font-size:small;background:#fff;background:var(--indextable-hover-bg,#fff);color:#000;color:var(--text,#000);box-shadow:0 1em 3em -.4em rgba(0,0,0,.3),0 0 1px 1px rgba(0,0,0,.05);box-shadow:0 1em 3em -.4em var(--tocsidebar-shadow,rgba(0,0,0,.3)),0 0 1px 1px var(--tocsidebar-shadow,rgba(0,0,0,.05));border-radius:2px}
.dfn-panel:not(.docked)>.caret{position:absolute;top:-9px}
.dfn-panel:not(.docked)>.caret::after,.dfn-panel:not(.docked)>.caret::before{content:"";position:absolute;border:10px solid transparent;border-top:0;border-bottom:10px solid #fff;border-bottom-color:var(--indextable-hover-bg,#fff);top:0}
.dfn-panel:not(.docked)>.caret::before{border-bottom:9px solid #a2a9b1;border-bottom-color:var(--indextable-hover-bg,#a2a9b1)}
.dfn-panel *{margin:0}
.dfn-panel b{display:block;color:#000;color:var(--text,#000);margin-top:.25em}
.dfn-panel ul a[href]{color:#333;color:var(--text,#333)}
.dfn-panel>div{display:flex}
.dfn-panel a.self-link{font-weight:700;margin-right:auto}
.dfn-panel .marker{padding:.1em;margin-left:.5em;border-radius:.2em;text-align:center;white-space:nowrap;font-size:90%;color:#040b1c}
.dfn-panel .marker.dfn-exported{background:#d1edfd;box-shadow:0 0 0 .125em #1ca5f940}
.dfn-panel .marker.idl-block{background:#8ccbf2;box-shadow:0 0 0 .125em #0670b161}
.dfn-panel a:not(:hover){text-decoration:none!important;border-bottom:none!important}
.dfn-panel a[href]:hover{border-bottom-width:1px}
.dfn-panel ul{padding:0}
.dfn-panel li{margin-left:1em}
.dfn-panel.docked{position:fixed;left:.5em;top:unset;bottom:2em;margin:0 auto;max-width:calc(100vw - .75em * 2 - .5em - .2em * 2);max-height:30vh;overflow:auto}
</style>
    
    
<title>MPEG-2 TS Byte Stream Format</title>
    
<style id="respec-mainstyle">
@keyframes pop{
0%{transform:scale(1,1)}
25%{transform:scale(1.25,1.25);opacity:.75}
100%{transform:scale(1,1)}
}
a.internalDFN{color:inherit;border-bottom:1px solid #99c;text-decoration:none}
a.externalDFN{color:inherit;border-bottom:1px dotted #ccc;text-decoration:none}
a.bibref{text-decoration:none}
.respec-offending-element:target{animation:pop .25s ease-in-out 0s 1}
.respec-offending-element,a[href].respec-offending-element{text-decoration:red wavy underline}
@supports not (text-decoration:red wavy underline){
.respec-offending-element:not(pre){display:inline-block}
.respec-offending-element{background:url(data:image/gif;base64,R0lGODdhBAADAPEAANv///8AAP///wAAACwAAAAABAADAEACBZQjmIAFADs=) bottom repeat-x}
}
#references :target{background:#eaf3ff;animation:pop .4s ease-in-out 0s 1}
cite .bibref{font-style:normal}
a[href].orcid{padding-left:4px;padding-right:4px}
a[href].orcid>svg{margin-bottom:-2px}
ol.tof,ul.tof{list-style:none outside none}
.caption{margin-top:.5em;font-style:italic}
#issue-summary>ul{column-count:2}
#issue-summary li{list-style:none;display:inline-block}
details.respec-tests-details{margin-left:1em;display:inline-block;vertical-align:top}
details.respec-tests-details>*{padding-right:2em}
details.respec-tests-details[open]{z-index:999999;position:absolute;border:thin solid #cad3e2;border-radius:.3em;background-color:#fff;padding-bottom:.5em}
details.respec-tests-details[open]>summary{border-bottom:thin solid #cad3e2;padding-left:1em;margin-bottom:1em;line-height:2em}
details.respec-tests-details>ul{width:100%;margin-top:-.3em}
details.respec-tests-details>li{padding-left:1em}
.self-link:hover{opacity:1;text-decoration:none;background-color:transparent}
aside.example .marker>a.self-link{color:inherit}
.header-wrapper{display:flex;align-items:baseline}
:is(h2,h3,h4,h5,h6):not(#toc>h2,#abstract>h2,#sotd>h2,.head>h2){position:relative;left:-.5em}
:is(h2,h3,h4,h5,h6):not(#toch2)+a.self-link{color:inherit;order:-1;position:relative;left:-1.1em;font-size:1rem;opacity:.5}
:is(h2,h3,h4,h5,h6)+a.self-link::before{content:"§";text-decoration:none;color:var(--heading-text)}
:is(h2,h3)+a.self-link{top:-.2em}
:is(h4,h5,h6)+a.self-link::before{color:#000}
@media (max-width:767px){
dd{margin-left:0}
}
@media print{
.removeOnSave{display:none}
}
</style>
    
  
<meta name="color-scheme" content="light">
<meta name="revision" content="edf8261e81e53ac23d2cc4bdd7026ce8957b999e">
<style>
.hljs{--base:#fafafa;--mono-1:#383a42;--mono-2:#686b77;--mono-3:#717277;--hue-1:#0b76c5;--hue-2:#336ae3;--hue-3:#a626a4;--hue-4:#42803c;--hue-5:#ca4706;--hue-5-2:#c91243;--hue-6:#986801;--hue-6-2:#9a6a01}
@media (prefers-color-scheme:dark){
.hljs{--base:#282c34;--mono-1:#abb2bf;--mono-2:#818896;--mono-3:#5c6370;--hue-1:#56b6c2;--hue-2:#61aeee;--hue-3:#c678dd;--hue-4:#98c379;--hue-5:#e06c75;--hue-5-2:#be5046;--hue-6:#d19a66;--hue-6-2:#e6c07b}
}
.hljs{display:block;overflow-x:auto;padding:.5em;color:#383a42;color:var(--mono-1,#383a42);background:#fafafa;background:var(--base,#fafafa)}
.hljs-comment,.hljs-quote{color:#717277;color:var(--mono-3,#717277);font-style:italic}
.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4;color:var(--hue-3,#a626a4)}
.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#ca4706;color:var(--hue-5,#ca4706);font-weight:700}
.hljs-literal{color:#0b76c5;color:var(--hue-1,#0b76c5)}
.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#42803c;color:var(--hue-4,#42803c)}
.hljs-built_in,.hljs-class .hljs-title{color:#9a6a01;color:var(--hue-6-2,#9a6a01)}
.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801;color:var(--hue-6,#986801)}
.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#336ae3;color:var(--hue-2,#336ae3)}
.hljs-emphasis{font-style:italic}
.hljs-strong{font-weight:700}
.hljs-link{text-decoration:underline}
</style>
<style>
var{position:relative;cursor:pointer}
var[data-type]::after,var[data-type]::before{position:absolute;left:50%;top:-6px;opacity:0;transition:opacity .4s;pointer-events:none}
var[data-type]::before{content:"";transform:translateX(-50%);border-width:4px 6px 0 6px;border-style:solid;border-color:transparent;border-top-color:#222}
var[data-type]::after{content:attr(data-type);transform:translateX(-50%) translateY(-100%);background:#222;text-align:center;font-family:"Dank Mono","Fira Code",monospace;font-style:normal;padding:6px;border-radius:3px;color:#daca88;text-indent:0;font-weight:400}
var[data-type]:hover::after,var[data-type]:hover::before{opacity:1}
</style>
<script id="initialUserConfig" type="application/json">{
  "specStatus": "ED",
  "shortName": "mse-byte-stream-format-mp2t",
  "edDraftURI": "https://w3c.github.io/mse-byte-stream-format-mp2t/",
  "editors": [
    {
      "name": "Mark Watson",
      "company": "Netflix Inc.",
      "companyURL": "https://www.netflix.com/",
      "w3cid": "46379"
    }
  ],
  "formerEditors": [
    {
      "name": "Matthew Wolenetz",
      "mailto": "matt.wolenetz@gmail.com",
      "note": "Until February 2024",
      "company": "W3C Invited Expert",
      "w3cid": "148095",
      "url": "mailto:matt.wolenetz@gmail.com"
    },
    {
      "name": "Jerry Smith",
      "note": "Until September 2017",
      "company": "Microsoft Corporation",
      "companyURL": "https://www.microsoft.com/"
    },
    {
      "name": "Aaron Colwell",
      "note": "Until April 2015",
      "company": "Google Inc.",
      "companyURL": "https://www.google.com/"
    },
    {
      "name": "Adrian Bateman",
      "note": "Until April 2015",
      "company": "Microsoft Corporation",
      "companyURL": "https://www.microsoft.com/"
    }
  ],
  "group": "media",
  "github": "w3c/mse-byte-stream-format-mp2t",
  "wgPublicList": "public-media-wg",
  "xref": [
    "html",
    "media-source"
  ],
  "gitRevision": "edf8261e81e53ac23d2cc4bdd7026ce8957b999e",
  "publishISODate": "2024-07-23T00:00:00.000Z",
  "generatedSubtitle": "W3C Editor's Draft 23 July 2024"
}</script>
<link rel="stylesheet" href="https://www.w3.org/StyleSheets/TR/2021/W3C-ED"></head>
  <body class="h-entry" data-cite="html media-source"><div class="head">
    <p class="logos"><a class="logo" href="https://www.w3.org/"><img crossorigin="" alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72">
  </a></p>
    <h1 id="title" class="title">MPEG-2 TS Byte Stream Format</h1> 
    <p id="w3c-state"><a href="https://www.w3.org/standards/types#ED">W3C Editor's Draft</a> <time class="dt-published" datetime="2024-07-23">23 July 2024</time></p>
    <details open="">
      <summary>More details about this document</summary>
      <dl>
        <dt>This version:</dt><dd>
                <a class="u-url" href="https://w3c.github.io/mse-byte-stream-format-mp2t/">https://w3c.github.io/mse-byte-stream-format-mp2t/</a>
              </dd>
        <dt>Latest published version:</dt><dd>
                <a href="https://www.w3.org/TR/mse-byte-stream-format-mp2t/">https://www.w3.org/TR/mse-byte-stream-format-mp2t/</a>
              </dd>
        <dt>Latest editor's draft:</dt><dd><a href="https://w3c.github.io/mse-byte-stream-format-mp2t/">https://w3c.github.io/mse-byte-stream-format-mp2t/</a></dd>
        <dt>History:</dt><dd>
                    <a href="https://www.w3.org/standards/history/mse-byte-stream-format-mp2t/">https://www.w3.org/standards/history/mse-byte-stream-format-mp2t/</a>
                  </dd><dd>
                    <a href="https://github.com/w3c/mse-byte-stream-format-mp2t/commits/">Commit history</a>
                  </dd>
        
        
        
        
        
        <dt>Editor:</dt><dd class="editor p-author h-card vcard" data-editor-id="46379">
    <span class="p-name fn">Mark Watson</span> (<a class="p-org org h-org" href="https://www.netflix.com/">Netflix Inc.</a>)
  </dd>
        <dt>
                Former editors:
              </dt><dd class="editor p-author h-card vcard" data-editor-id="148095">
    <a class="ed_mailto u-email email p-name" href="mailto:matt.wolenetz@gmail.com">Matthew Wolenetz</a> (<span class="p-org org h-org">W3C Invited Expert</span>) (Until February 2024)
  </dd><dd class="editor p-author h-card vcard">
    <span class="p-name fn">Jerry Smith</span> (<a class="p-org org h-org" href="https://www.microsoft.com/">Microsoft Corporation</a>) (Until September 2017)
  </dd><dd class="editor p-author h-card vcard">
    <span class="p-name fn">Aaron Colwell</span> (<a class="p-org org h-org" href="https://www.google.com/">Google Inc.</a>) (Until April 2015)
  </dd><dd class="editor p-author h-card vcard">
    <span class="p-name fn">Adrian Bateman</span> (<a class="p-org org h-org" href="https://www.microsoft.com/">Microsoft Corporation</a>) (Until April 2015)
  </dd>
        
        <dt>Feedback:</dt><dd>
        <a href="https://github.com/w3c/mse-byte-stream-format-mp2t/">GitHub w3c/mse-byte-stream-format-mp2t</a>
        (<a href="https://github.com/w3c/mse-byte-stream-format-mp2t/pulls/">pull requests</a>,
        <a href="https://github.com/w3c/mse-byte-stream-format-mp2t/issues/new/choose">new issue</a>,
        <a href="https://github.com/w3c/mse-byte-stream-format-mp2t/issues/">open issues</a>)
      </dd><dd><a href="mailto:public-media-wg@w3.org?subject=%5Bmse-byte-stream-format-mp2t%5D%20YOUR%20TOPIC%20HERE">public-media-wg@w3.org</a> with subject line <kbd>[mse-byte-stream-format-mp2t] <em>… message topic …</em></kbd> (<a rel="discussion" href="https://lists.w3.org/Archives/Public/public-media-wg">archives</a>)</dd>
        
        
      </dl>
    </details>
    
    
    <p class="copyright">
    <a href="https://www.w3.org/policies/#copyright">Copyright</a>
    ©
    2024
    
    <a href="https://www.w3.org/">World Wide Web Consortium</a>.
    <abbr title="World Wide Web Consortium">W3C</abbr><sup>®</sup>
    <a href="https://www.w3.org/policies/#Legal_Disclaimer">liability</a>,
    <a href="https://www.w3.org/policies/#W3C_Trademarks">trademark</a> and
    <a rel="license" href="https://www.w3.org/copyright/software-license-2023/" title="W3C Software and Document Notice and License">permissive document license</a> rules apply.
  </p>
    <hr title="Separator for header">
  </div>
    <section id="abstract" class="introductory"><h2>Abstract</h2>
      This specification defines a <cite><a data-matched-text="[[[MEDIA-SOURCE]]]" href="https://www.w3.org/TR/media-source-2/">Media Source Extensions™</a></cite> [<cite><a class="bibref" data-link-type="biblio" href="#bib-media-source" title="Media Source Extensions™">MEDIA-SOURCE</a></cite>] byte stream format specification based on MPEG-2 Transport Streams [<cite><a class="bibref" data-link-type="biblio" href="#bib-mpeg2ts" title="Information technology — Generic coding of moving pictures and associated audio information — Part 1: Systems">MPEG2TS</a></cite>].
    </section>

    <section id="sotd" class="introductory"><h2>Status of This Document</h2><p><em>This section describes the status of this
      document at the time of its publication. A list of current <abbr title="World Wide Web Consortium">W3C</abbr>
      publications and the latest revision of this technical report can be found
      in the <a href="https://www.w3.org/TR/"><abbr title="World Wide Web Consortium">W3C</abbr> technical reports index</a> at
      https://www.w3.org/TR/.</em></p>
      <p>The working group maintains <a href="https://github.com/w3c/mse-byte-stream-format-mp2t/issues">a list of all bug reports that the editors have not yet tried to address</a>;
      there may also be related open bugs in the <a href="https://github.com/w3c/media-source">GitHub repository</a> of the <cite><a data-matched-text="[[[MEDIA-SOURCE]]]" href="https://www.w3.org/TR/media-source-2/">Media Source Extensions™</a></cite> specification.</p>
    <p>
    This document was published by the <a href="https://www.w3.org/groups/wg/media">Media Working Group</a> as
    an Editor's Draft. 
  </p><p>Publication as an Editor's Draft does not
  imply endorsement by <abbr title="World Wide Web Consortium">W3C</abbr> and its Members. </p><p>
    This is a draft document and may be updated, replaced or obsoleted by other
    documents at any time. It is inappropriate to cite this document as other
    than work in progress.
    
  </p><p>
    
        This document was produced by a group
        operating under the
        <a href="https://www.w3.org/policies/patent-policy/"><abbr title="World Wide Web Consortium">W3C</abbr> Patent
          Policy</a>.
      
    
                <abbr title="World Wide Web Consortium">W3C</abbr> maintains a
                <a rel="disclosure" href="https://www.w3.org/groups/wg/media/ipr">public list of any patent disclosures</a>
          made in connection with the deliverables of
          the group; that page also includes
          instructions for disclosing a patent. An individual who has actual
          knowledge of a patent which the individual believes contains
          <a href="https://www.w3.org/policies/patent-policy/#def-essential">Essential Claim(s)</a>
          must disclose the information in accordance with
          <a href="https://www.w3.org/policies/patent-policy/#sec-Disclosure">section 6 of the <abbr title="World Wide Web Consortium">W3C</abbr> Patent Policy</a>.
        
  </p><p>
                      This document is governed by the
                      <a id="w3c_process_revision" href="https://www.w3.org/policies/process/20231103/">03 November 2023 <abbr title="World Wide Web Consortium">W3C</abbr> Process Document</a>.
                    </p></section><nav id="toc"><h2 class="introductory" id="table-of-contents">Table of Contents</h2><ol class="toc"><li class="tocline"><a class="tocxref" href="#abstract">Abstract</a></li><li class="tocline"><a class="tocxref" href="#sotd">Status of This Document</a></li><li class="tocline"><a class="tocxref" href="#introduction"><bdi class="secno">1. </bdi>Introduction</a></li><li class="tocline"><a class="tocxref" href="#mime-parameters"><bdi class="secno">2. </bdi>MIME-type info</a></li><li class="tocline"><a class="tocxref" href="#mpeg2ts-general"><bdi class="secno">3. </bdi>General Transport Stream Requirements</a></li><li class="tocline"><a class="tocxref" href="#mpeg2ts-init-segments"><bdi class="secno">4. </bdi>Initialization Segments</a></li><li class="tocline"><a class="tocxref" href="#mpeg2ts-media-segments"><bdi class="secno">5. </bdi>Media Segments</a></li><li class="tocline"><a class="tocxref" href="#mpeg2ts-random-access-points"><bdi class="secno">6. </bdi>Random Access Points</a></li><li class="tocline"><a class="tocxref" href="#mpeg2ts-discontinuities"><bdi class="secno">7. </bdi>Timestamp Rollover &amp; Discontinuities</a></li><li class="tocline"><a class="tocxref" href="#conformance"><bdi class="secno">8. </bdi>Conformance</a></li><li class="tocline"><a class="tocxref" href="#acknowledgements"><bdi class="secno">9. </bdi>Acknowledgments</a></li><li class="tocline"><a class="tocxref" href="#references"><bdi class="secno">A. </bdi>References</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#normative-references"><bdi class="secno">A.1 </bdi>Normative references</a></li></ol></li></ol></nav>

    <section id="introduction"><div class="header-wrapper"><h2 id="x1-introduction"><bdi class="secno">1. </bdi>Introduction</h2><a class="self-link" href="#introduction" aria-label="Permalink for Section 1."></a></div>
      
      <p>This specification defines segment formats for implementations of <cite><a data-matched-text="[[[MEDIA-SOURCE]]]" href="https://www.w3.org/TR/media-source-2/">Media Source Extensions™</a></cite> [<cite><a class="bibref" data-link-type="biblio" href="#bib-media-source" title="Media Source Extensions™">MEDIA-SOURCE</a></cite>] that choose to support MPEG-2 Transport Streams [<cite><a class="bibref" data-link-type="biblio" href="#bib-mpeg2ts" title="Information technology — Generic coding of moving pictures and associated audio information — Part 1: Systems">MPEG2TS</a></cite>].</p>
      <p>It defines the MIME-type parameters used to signal codecs, and provides
      the necessary format specific definitions for <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/media-source-2/#dfn-initialization-segment">initialization segments</a>, <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/media-source-2/#dfn-media-segment">media segments</a>, and <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/media-source-2/#random-access-point">random access points</a> required by
      the <a href="https://www.w3.org/TR/media-source-2/#byte-stream-formats">Byte Stream Formats section</a> of the <cite><a data-matched-text="[[[MEDIA-SOURCE]]]" href="https://www.w3.org/TR/media-source-2/">Media Source Extensions™</a></cite> specification. This document also defines extra behaviors and state that only apply to this byte stream format.</p>
    </section>

    <section id="mime-parameters"><div class="header-wrapper"><h2 id="x2-mime-type-info"><bdi class="secno">2. </bdi>MIME-type info</h2><a class="self-link" href="#mime-parameters" aria-label="Permalink for Section 2."></a></div>
      
      <p>The MIME-type/subtype pair of "video/MP2T", as specified in [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc3551" title="RTP Profile for Audio and Video Conferences with Minimal Control">RFC3551</a></cite>], <em class="rfc2119">MUST</em> be used for byte streams that conform
        to this specification.</p>

      <p>The following parameter can be used in the MIME-type passed to <a data-link-type="idl" data-lt="isTypeSupported()" data-type="method" href="https://www.w3.org/TR/media-source-2/#dom-mediasource-istypesupported"><code>isTypeSupported</code></a><code>()</code> or <a data-link-type="idl" data-lt="addSourceBuffer()" data-type="method" href="https://www.w3.org/TR/media-source-2/#dom-mediasource-addsourcebuffer"><code>addSourceBuffer</code></a><code>()</code>.</p>
      <dl>
        <dt>codecs</dt>
        <dd>
          A comma separated list of codec IDs used to specify what codecs will be used in the byte stream. Implementations <em class="rfc2119">SHOULD</em> accept IDs in the form specified by [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc6381" title="The 'Codecs' and 'Profiles' Parameters for &quot;Bucket&quot; Media Types">RFC6381</a></cite>].
          <div class="note" role="note" id="issue-container-generatedID"><div role="heading" class="note-title marker" id="h-note" aria-level="3"><span>Note</span></div><div class="">Implementations <em class="rfc2119">MAY</em> only implement a subset of the codecs and profiles mentioned in the RFC.</div></div>
        </dd>
      </dl>
    </section>

    <section id="mpeg2ts-general"><div class="header-wrapper"><h2 id="x3-general-transport-stream-requirements"><bdi class="secno">3. </bdi>General Transport Stream Requirements</h2><a class="self-link" href="#mpeg2ts-general" aria-label="Permalink for Section 3."></a></div>
      
      <p>MPEG-2 TS <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/media-source-2/#dfn-media-segment">media segments</a> and <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/media-source-2/#dfn-initialization-segment">initialization segments</a> <em class="rfc2119">MUST</em> conform to the MPEG-2 TS Adaptive Profile [<cite><a class="bibref" data-link-type="biblio" href="#bib-mpeg2ts" title="Information technology — Generic coding of moving pictures and associated audio information — Part 1: Systems">MPEG2TS</a></cite>].</p>

      <p>The user agent <em class="rfc2119">MUST</em> run the <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/media-source-2/#dfn-append-error">append error</a> algorithm if any of the following conditions are met:</p>
      <ol>
        <li>Segments do not contain complete MPEG-2 TS packets.</li>
        <li>Segments do not contain complete PES packets and sections.</li>
        <li>Segments contain more than one program.</li>
        <li>At least one MPEG-2 TS packet has a non-zero transport_error_indicator.</li>
      </ol>
    </section>
    <section id="mpeg2ts-init-segments"><div class="header-wrapper"><h2 id="x4-initialization-segments"><bdi class="secno">4. </bdi>Initialization Segments</h2><a class="self-link" href="#mpeg2ts-init-segments" aria-label="Permalink for Section 4."></a></div>
      
      <p>An MPEG-2 TS <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/media-source-2/#dfn-initialization-segment">initialization segment</a> consists of a single PAT and a single PMT.</p>
      <p>The user agent <em class="rfc2119">MUST</em> run the <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/media-source-2/#dfn-append-error">append error</a> algorithm if any of the following conditions are met:</p>
      <ol>
        <li>A PAT is not present in the <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/media-source-2/#dfn-initialization-segment">initialization segment</a></li>
        <li>A PMT is not present in the <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/media-source-2/#dfn-initialization-segment">initialization segment</a></li>
      </ol>

      <p>The user agent <em class="rfc2119">MUST</em> accept and ignore other SI, such as CAT, that are invariant for all subsequent <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/media-source-2/#dfn-media-segment">media segments</a>.</p>
      <p>The user agent <em class="rfc2119">MUST</em> source attribute values for <code>id</code>, <code>kind</code>, <code>label</code> and <code>language</code> for <a data-link-type="idl" data-lt="AudioTrack" data-type="interface" href="https://html.spec.whatwg.org/multipage/media.html#audiotrack"><code>AudioTrack</code></a>, <a data-link-type="idl" data-lt="VideoTrack" data-type="interface" href="https://html.spec.whatwg.org/multipage/media.html#videotrack"><code>VideoTrack</code></a> and
        <a data-link-type="idl" data-lt="TextTrack" data-type="interface" href="https://html.spec.whatwg.org/multipage/media.html#texttrack"><code>TextTrack</code></a> objects as described for MPEG-2 Transport Streams in the in-band tracks spec [<cite><a class="bibref" data-link-type="biblio" href="#bib-inbandtracks" title="Sourcing In-band Media Resource Tracks from Media Containers into HTML">INBANDTRACKS</a></cite>].</p>
    </section>

    <section id="mpeg2ts-media-segments"><div class="header-wrapper"><h2 id="x5-media-segments"><bdi class="secno">5. </bdi>Media Segments</h2><a class="self-link" href="#mpeg2ts-media-segments" aria-label="Permalink for Section 5."></a></div>
      

      <p>The user agent <em class="rfc2119">MUST</em> run the <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/media-source-2/#dfn-append-error">append error</a> algorithm if any of the following conditions are met:</p>
      <ol>
        <li>A <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/media-source-2/#dfn-media-segment">media segment</a> relies on initialization information in another <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/media-source-2/#dfn-media-segment">media segment</a>.</li>
        <li>At least one PES packet does not have a PTS timestamp.</li>
        <li>PCR is not present in the Segment prior to the first byte of a TS packet payload containing media data.</li>
      </ol>

      The user agent will accept and ignore PSI that is identical to the information in the last <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/media-source-2/#dfn-initialization-segment">initialization segment</a> which may appear repeatedly throughout the segment.
    </section>

    <section id="mpeg2ts-random-access-points"><div class="header-wrapper"><h2 id="x6-random-access-points"><bdi class="secno">6. </bdi>Random Access Points</h2><a class="self-link" href="#mpeg2ts-random-access-points" aria-label="Permalink for Section 6."></a></div>
      
      <p>A <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/media-source-2/#random-access-point">random access point</a> as defined in this specification corresponds to Elementary Stream Random Access Point as defined in
        [<cite><a class="bibref" data-link-type="biblio" href="#bib-mpeg2ts" title="Information technology — Generic coding of moving pictures and associated audio information — Part 1: Systems">MPEG2TS</a></cite>].</p>
    </section>
    <section id="mpeg2ts-discontinuities"><div class="header-wrapper"><h2 id="x7-timestamp-rollover-discontinuities"><bdi class="secno">7. </bdi>Timestamp Rollover &amp; Discontinuities</h2><a class="self-link" href="#mpeg2ts-discontinuities" aria-label="Permalink for Section 7."></a></div>
      
      <p>Timestamp rollovers and discontinuities <em class="rfc2119">MUST</em> be handled by the UA. The UA's MPEG-2 TS implementation <em class="rfc2119">MUST</em> maintain an internal offset
        variable, <dfn id="dfn-mpeg2ts_timestampoffset" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">MPEG2TS_timestampOffset</dfn>, to keep track of the offset that needs to be applied to timestamps
        that have rolled over or are part of a discontinuity. <a href="#dfn-mpeg2ts_timestampoffset" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-mpeg2ts_timestampoffset-1">MPEG2TS_timestampOffset</a> is initially set to 0 when the <a class="externalDFN">SourceBuffer</a> is
        created.  This offset <em class="rfc2119">MUST</em> be applied to the timestamps as part of the conversion process from MPEG-2 TS packets
        into <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/media-source-2/#dfn-coded-frame">coded frames</a> for the <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/media-source-2/#dfn-coded-frame-processing">coded frame processing</a> algorithm. This results in the coded frame timestamps
        for a packet being computed by the following equations:</p>
      <pre aria-busy="false"><code class="hljs">Coded Frame Presentation Timestamp = (MPEG-2 TS presentation timestamp) + MPEG2TS_timestampOffset
Coded Frame Decode Timestamp = (MPEG-2 TS decode timestamp) + MPEG2TS_timestampOffset</code></pre>

      <p><a href="#dfn-mpeg2ts_timestampoffset" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-mpeg2ts_timestampoffset-2">MPEG2TS_timestampOffset</a> is updated in the following ways:</p>
      <ul>
        <li>Each time a timestamp rollover is detected, 2^33 <em class="rfc2119">MUST</em> be added to <a href="#dfn-mpeg2ts_timestampoffset" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-mpeg2ts_timestampoffset-3">MPEG2TS_timestampOffset</a>.</li>
        <li>When a discontinuity is detected, <a href="#dfn-mpeg2ts_timestampoffset" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-mpeg2ts_timestampoffset-4">MPEG2TS_timestampOffset</a> <em class="rfc2119">MUST</em> be adjusted to make the timestamps after the discontinuity appear
          to come immediately after the timestamps before the discontinuity.</li>
        <li>When <a data-link-type="idl" data-lt="abort()" data-type="method" href="https://www.w3.org/TR/media-source-2/#dom-sourcebuffer-abort"><code>abort</code></a><code>()</code> is called, <a href="#dfn-mpeg2ts_timestampoffset" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-mpeg2ts_timestampoffset-5">MPEG2TS_timestampOffset</a> <em class="rfc2119">MUST</em> be set to 0.</li>
        <li>When <a data-link-type="idl" data-type="attribute" href="https://www.w3.org/TR/media-source-2/#dom-sourcebuffer-timestampoffset"><code>timestampOffset</code></a> is successfully set, <a href="#dfn-mpeg2ts_timestampoffset" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-mpeg2ts_timestampoffset-6">MPEG2TS_timestampOffset</a> <em class="rfc2119">MUST</em> be set to 0.</li>
      </ul>
    </section>

    <section id="conformance"><div class="header-wrapper"><h2 id="x8-conformance"><bdi class="secno">8. </bdi>Conformance</h2><a class="self-link" href="#conformance" aria-label="Permalink for Section 8."></a></div><p>As well as sections marked as non-normative, all authoring guidelines, diagrams, examples, and notes in this specification are non-normative. Everything else in this specification is normative.</p><p>
        The key words <em class="rfc2119">MAY</em>, <em class="rfc2119">MUST</em>, and <em class="rfc2119">SHOULD</em> in this document
        are to be interpreted as described in
        <a href="https://datatracker.ietf.org/doc/html/bcp14">BCP 14</a>
        [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">RFC2119</a></cite>] [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc8174" title="Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words">RFC8174</a></cite>]
        when, and only when, they appear in all capitals, as shown here.
      </p></section>

    <section id="acknowledgements"><div class="header-wrapper"><h2 id="x9-acknowledgments"><bdi class="secno">9. </bdi>Acknowledgments</h2><a class="self-link" href="#acknowledgements" aria-label="Permalink for Section 9."></a></div>
      
      The editors would like to thank
      Alex Giladi,
      Bob Lund,
      David Singer,
      Duncan Rowden,
      Glenn Adams,
      Mark Vickers,
      and Michael Thornburgh for their contributions to this specification.
    </section>
  

<section id="references" class="appendix"><div class="header-wrapper"><h2 id="a-references"><bdi class="secno">A. </bdi>References</h2><a class="self-link" href="#references" aria-label="Permalink for Appendix A."></a></div><section id="normative-references"><div class="header-wrapper"><h3 id="a-1-normative-references"><bdi class="secno">A.1 </bdi>Normative references</h3><a class="self-link" href="#normative-references" aria-label="Permalink for Appendix A.1"></a></div>
    
    <dl class="bibliography"><dt id="bib-html">[html]</dt><dd>
      <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Anne van Kesteren; Domenic Denicola; Ian Hickson; Philip Jägenstedt; Simon Pieters.  WHATWG. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
    </dd><dt id="bib-inbandtracks">[INBANDTRACKS]</dt><dd>
      <a href="https://dev.w3.org/html5/html-sourcing-inband-tracks/"><cite>Sourcing In-band Media Resource Tracks from Media Containers into HTML</cite></a>. Silvia Pfeiffer; Bob Lund.  W3C. 26 April 2015. Unofficial Draft. URL: <a href="https://dev.w3.org/html5/html-sourcing-inband-tracks/">https://dev.w3.org/html5/html-sourcing-inband-tracks/</a>
    </dd><dt id="bib-media-source">[MEDIA-SOURCE]</dt><dd>
      <a href="https://www.w3.org/TR/media-source-2/"><cite>Media Source Extensions™</cite></a>. Jean-Yves Avenard; Mark Watson.  W3C. 4 July 2024. W3C Working Draft. URL: <a href="https://www.w3.org/TR/media-source-2/">https://www.w3.org/TR/media-source-2/</a>
    </dd><dt id="bib-mpeg2ts">[MPEG2TS]</dt><dd>
      <a href="https://www.iso.org/standard/87619.html"><cite>Information technology — Generic coding of moving pictures and associated audio information — Part 1: Systems</cite></a>.  ISO/IEC. December 2023. Published. URL: <a href="https://www.iso.org/standard/87619.html">https://www.iso.org/standard/87619.html</a>
    </dd><dt id="bib-rfc2119">[RFC2119]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. S. Bradner.  IETF. March 1997. Best Current Practice. URL: <a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>
    </dd><dt id="bib-rfc3551">[RFC3551]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc3551"><cite>RTP Profile for Audio and Video Conferences with Minimal Control</cite></a>. H. Schulzrinne; S. Casner.  IETF. July 2003. Internet Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc3551">https://www.rfc-editor.org/rfc/rfc3551</a>
    </dd><dt id="bib-rfc6381">[RFC6381]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc6381"><cite>The 'Codecs' and 'Profiles' Parameters for "Bucket" Media Types</cite></a>. R. Gellens; D. Singer; P. Frojdh.  IETF. August 2011. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc6381">https://www.rfc-editor.org/rfc/rfc6381</a>
    </dd><dt id="bib-rfc8174">[RFC8174]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc8174"><cite>Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words</cite></a>. B. Leiba.  IETF. May 2017. Best Current Practice. URL: <a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>
    </dd></dl>
  </section></section><p role="navigation" id="back-to-top">
    <a href="#title"><abbr title="Back to Top">↑</abbr></a>
  </p><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-mpeg2ts_timestampoffset" aria-label="Links in this document to definition: MPEG2TS_timestampOffset">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-mpeg2ts_timestampoffset" aria-label="Permalink for definition: MPEG2TS_timestampOffset. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-mpeg2ts_timestampoffset-1" title="§ 7. Timestamp Rollover &amp; Discontinuities">§ 7. Timestamp Rollover &amp; Discontinuities</a> <a href="#ref-for-dfn-mpeg2ts_timestampoffset-2" title="Reference 2">(2)</a> <a href="#ref-for-dfn-mpeg2ts_timestampoffset-3" title="Reference 3">(3)</a> <a href="#ref-for-dfn-mpeg2ts_timestampoffset-4" title="Reference 4">(4)</a> <a href="#ref-for-dfn-mpeg2ts_timestampoffset-5" title="Reference 5">(5)</a> <a href="#ref-for-dfn-mpeg2ts_timestampoffset-6" title="Reference 6">(6)</a> 
    </li>
  </ul>
    </div><script id="respec-dfn-panel">(() => {
// @ts-check
if (document.respec) {
  document.respec.ready.then(setupPanel);
} else {
  setupPanel();
}

function setupPanel() {
  const listener = panelListener();
  document.body.addEventListener("keydown", listener);
  document.body.addEventListener("click", listener);
}

function panelListener() {
  /** @type {HTMLElement} */
  let panel = null;
  return event => {
    const { target, type } = event;

    if (!(target instanceof HTMLElement)) return;

    // For keys, we only care about Enter key to activate the panel
    // otherwise it's activated via a click.
    if (type === "keydown" && event.key !== "Enter") return;

    const action = deriveAction(event);

    switch (action) {
      case "show": {
        hidePanel(panel);
        /** @type {HTMLElement} */
        const dfn = target.closest("dfn, .index-term");
        panel = document.getElementById(`dfn-panel-for-${dfn.id}`);
        const coords = deriveCoordinates(event);
        displayPanel(dfn, panel, coords);
        break;
      }
      case "dock": {
        panel.style.left = null;
        panel.style.top = null;
        panel.classList.add("docked");
        break;
      }
      case "hide": {
        hidePanel(panel);
        panel = null;
        break;
      }
    }
  };
}

/**
 * @param {MouseEvent|KeyboardEvent} event
 */
function deriveCoordinates(event) {
  const target = /** @type HTMLElement */ (event.target);

  // We prevent synthetic AT clicks from putting
  // the dialog in a weird place. The AT events sometimes
  // lack coordinates, so they have clientX/Y = 0
  const rect = target.getBoundingClientRect();
  if (
    event instanceof MouseEvent &&
    event.clientX >= rect.left &&
    event.clientY >= rect.top
  ) {
    // The event probably happened inside the bounding rect...
    return { x: event.clientX, y: event.clientY };
  }

  // Offset to the middle of the element
  const x = rect.x + rect.width / 2;
  // Placed at the bottom of the element
  const y = rect.y + rect.height;
  return { x, y };
}

/**
 * @param {Event} event
 */
function deriveAction(event) {
  const target = /** @type {HTMLElement} */ (event.target);
  const hitALink = !!target.closest("a");
  if (target.closest("dfn:not([data-cite]), .index-term")) {
    return hitALink ? "none" : "show";
  }
  if (target.closest(".dfn-panel")) {
    if (hitALink) {
      return target.classList.contains("self-link") ? "hide" : "dock";
    }
    const panel = target.closest(".dfn-panel");
    return panel.classList.contains("docked") ? "hide" : "none";
  }
  if (document.querySelector(".dfn-panel:not([hidden])")) {
    return "hide";
  }
  return "none";
}

/**
 * @param {HTMLElement} dfn
 * @param {HTMLElement} panel
 * @param {{ x: number, y: number }} clickPosition
 */
function displayPanel(dfn, panel, { x, y }) {
  panel.hidden = false;
  // distance (px) between edge of panel and the pointing triangle (caret)
  const MARGIN = 20;

  const dfnRects = dfn.getClientRects();
  // Find the `top` offset when the `dfn` can be spread across multiple lines
  let closestTop = 0;
  let minDiff = Infinity;
  for (const rect of dfnRects) {
    const { top, bottom } = rect;
    const diffFromClickY = Math.abs((top + bottom) / 2 - y);
    if (diffFromClickY < minDiff) {
      minDiff = diffFromClickY;
      closestTop = top;
    }
  }

  const top = window.scrollY + closestTop + dfnRects[0].height;
  const left = x - MARGIN;
  panel.style.left = `${left}px`;
  panel.style.top = `${top}px`;

  // Find if the panel is flowing out of the window
  const panelRect = panel.getBoundingClientRect();
  const SCREEN_WIDTH = Math.min(window.innerWidth, window.screen.width);
  if (panelRect.right > SCREEN_WIDTH) {
    const newLeft = Math.max(MARGIN, x + MARGIN - panelRect.width);
    const newCaretOffset = left - newLeft;
    panel.style.left = `${newLeft}px`;
    /** @type {HTMLElement} */
    const caret = panel.querySelector(".caret");
    caret.style.left = `${newCaretOffset}px`;
  }

  // As it's a dialog, we trap focus.
  // TODO: when <dialog> becomes a implemented, we should really
  // use that.
  trapFocus(panel, dfn);
}

/**
 * @param {HTMLElement} panel
 * @param {HTMLElement} dfn
 * @returns
 */
function trapFocus(panel, dfn) {
  /** @type NodeListOf<HTMLAnchorElement> elements */
  const anchors = panel.querySelectorAll("a[href]");
  // No need to trap focus
  if (!anchors.length) return;

  // Move focus to first anchor element
  const first = anchors.item(0);
  first.focus();

  const trapListener = createTrapListener(anchors, panel, dfn);
  panel.addEventListener("keydown", trapListener);

  // Hiding the panel releases the trap
  const mo = new MutationObserver(records => {
    const [record] = records;
    const target = /** @type HTMLElement */ (record.target);
    if (target.hidden) {
      panel.removeEventListener("keydown", trapListener);
      mo.disconnect();
    }
  });
  mo.observe(panel, { attributes: true, attributeFilter: ["hidden"] });
}

/**
 *
 * @param {NodeListOf<HTMLAnchorElement>} anchors
 * @param {HTMLElement} panel
 * @param {HTMLElement} dfn
 * @returns
 */
function createTrapListener(anchors, panel, dfn) {
  const lastIndex = anchors.length - 1;
  let currentIndex = 0;
  return event => {
    switch (event.key) {
      // Hitting "Tab" traps us in a nice loop around elements.
      case "Tab": {
        event.preventDefault();
        currentIndex += event.shiftKey ? -1 : +1;
        if (currentIndex < 0) {
          currentIndex = lastIndex;
        } else if (currentIndex > lastIndex) {
          currentIndex = 0;
        }
        anchors.item(currentIndex).focus();
        break;
      }

      // Hitting "Enter" on an anchor releases the trap.
      case "Enter":
        hidePanel(panel);
        break;

      // Hitting "Escape" returns focus to dfn.
      case "Escape":
        hidePanel(panel);
        dfn.focus();
        return;
    }
  };
}

/** @param {HTMLElement} panel */
function hidePanel(panel) {
  if (!panel) return;
  panel.hidden = true;
  panel.classList.remove("docked");
}
})()</script><script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script></body></html>